<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Scanner</title>
    <link rel = "stylesheet" href = "../static/scan.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500&family=Poppins&display=swap" rel="stylesheet">


    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        #reader {
            width: 300px;
            margin: 0 auto;
        }
        .mirrored video {
            transform: scaleX(-1);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <button id="toggleSidebar" class="toggle-btn">â˜°</button>
        <a href = "{{url_for('dashboard')}}">Dashboard</a>
        <a href="{{url_for('chats')}}">Chats</a>
        <a href="{{url_for('resources')}}">Resources</a>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <a href="{{ url_for('connect')}}">Connect</a>
        <a href="{{url_for('logout')}}">Log Out</a>

      </div>
    <div class = "container">
    <h2 style="text-align:center;">Scan QR Code to Connect</h2>
    <div id="reader"></div>
    <!-- Back Button -->
     <br>
    <a href="/connect" class="back-button">Back to Connect Page</a>
    </div>
    <script>
        const currentFacingMode = "user"; // Always use front camera
        const html5QrCode = new Html5Qrcode("reader");

        function startScanner() {
            html5QrCode.start(
                { facingMode: currentFacingMode },
                { fps: 10, qrbox: 250 },
                onScanSuccess
            ).then(() => {
                // Apply mirror effect if front camera
                if (currentFacingMode === "user") {
                    document.getElementById("reader").classList.add("mirrored");
                }
            }).catch(err => {
                console.error("QR Scanner Error:", err);
            });
        }

        function onScanSuccess(decodedText, decodedResult) {
            console.log(`Scanned code: ${decodedText}`);
            html5QrCode.stop().then(() => {
                window.location.href = decodedText;
            }).catch(err => {
                window.location.href = decodedText;
            });
        }

        // Start scanning when page loads
        startScanner();
    </script>
    <script>
        const toggleBtn = document.getElementById("toggleSidebar");
        const sidebar = document.querySelector(".sidebar");
            
        toggleBtn.addEventListener("click", () => {
          sidebar.classList.toggle("expanded");
        });
    </script>
</body>
</html>
